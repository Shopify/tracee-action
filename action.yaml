name: 'Aqua Security Tracee Stop and Check'
description: 'Stop & Checks Tracee results with Runtime Security and Forensics using eBPF'
author: 'Aqua Security'
inputs:
  workdir:
    description: "Working directory for Tracee"
    required: false
    default: "/tmp/tracee"
  fail-on-diff:
    description: "Fails the check if profile differences are found"
    required: false
    default: 'false'
  create-pr:
    description: "Creates a PR to the default branch with profile differences if found"
    required: false
    default: 'false'

runs:
  using: 'composite'
  steps:
  - shell: bash
    run: |
      echo "Stopping Tracee..."
      docker kill --signal="SIGINT" tracee-profiler
      docker wait tracee-profiler

      ${{ github.action_path }}/stop.sh ${{ inputs.workdir }} ${{ github.token }} ${{ inputs.fail-on-diff }} ${{ inputs.create-pr }}